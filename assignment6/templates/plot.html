<!DOCTYPE html>
<html>
  <head>
    <title>COVID-19 Norway</title>
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='favicon.png') }}" />

    <style>
      .error {
        color: red;
      }

      * {box-sizing: border-box;}

      .wrapper {
        text-align: center;
      }

      .center{
        margin:auto;
        width:400px;
      }

      body {
        margin: 0;
        font-family: Arial, Helvetica, sans-serif;
      }

      .header {
        overflow: hidden;
        background-color: #f1f1f1;
        padding: 20px 10px;
      }

      .header a {
        float: left;
        color: black;
        text-align: center;
        padding: 12px;
        text-decoration: none;
        font-size: 18px;
        line-height: 25px;
        border-radius: 4px;
      }

      .header a.logo {
        font-size: 25px;
        font-weight: bold;
      }

      .header a:hover {
        background-color: #ddd;
        color: black;
      }

      .header a.active {
        background-color: dodgerblue;
        color: white;
      }

      .header-right {
        float: right;
      }

      @media screen and (max-width: 500px) {
        .header a {
          float: none;
          display: block;
          text-align: left;
        }

        .header-right {
          float: none;
        }
      }

    </style>

    <script
      type="text/javascript"
      src="https://cdn.jsdelivr.net/npm//vega@5"
    ></script>
    <script
      type="text/javascript"
      src="https://cdn.jsdelivr.net/npm//vega-lite@4.8.1"
    ></script>
    <script
      type="text/javascript"
      src="https://cdn.jsdelivr.net/npm//vega-embed@6"
    ></script>

  </head>
  <body>

    <div class="header">
      <a href="/home" class="logo">COVID-19 Cases in Norway</a>
      <div class="header-right">
        <a class="active" href="/home">Home</a>
        <a href="/help">Help</a>
      </div>
    </div>

    &nbsp;
    &nbsp;
    <!--  call our submitForm() function on submit instead of the default -->
    <form onsubmit="return submitForm();" id="form">
  <div class="wrapper">
      <label for="chart">Chart Type</label>

<!--  select gives a dropdown. The selected option can be accessed with `selectedOptions[0]` on the select element -->

      <select name="chart_type" id="chart">
        <option value="reported">Reported Cases</option>
        <option value="cumulative">Cumulative Cases</option>
        <option value="both" selected="selected">Both</option>
      </select>
    </div>

    <br />
    &nbsp;

    <div class="wrapper">
      <label for="county">County</label>
      <select name="county_select" id="county">
        <option value="all_counties" selected="selected">All Counties</option>
        <option value="agder">Agder</option>
        <option value="innlandet">Innlandet</option>
        <option value="more-og-romsdal">Møre og Romsdal</option>
        <option value="nordland">Nordland</option>
        <option value="oslo">Oslo</option>
        <option value="rogaland">Rogaland</option>
        <option value="troms-og-finnmark">Troms og Finnmark</option>
        <option value="trondelag">Trøndelag</option>
        <option value="vestfold-og-telemark">Vestfold og Telemark</option>
        <option value="vestland">Vestland</option>
        <option value="viken">Viken</option>
      </select>
    </div>

    <br />
    &nbsp;

    <div class="wrapper">
        <label for="interval">Time Interval</label>
        <select name="time_interval" id="interval">
          <option value="daily" selected="selected">Daily</option>
          <option value="weekly">Weekly</option>
        </select>
      </div>

      <br />
      &nbsp;

    <div class="wrapper">
      <input type="submit" value="Plot" />
    </div>
    <br />
    &nbsp;
    </form>

    <div class="center">
    <div id="vis"></div>
    </div>


    <script>
      function submitForm() {
        // call our plot function when the form is submitted
        plot();
        // return false is important to prevent reloading the page on submit
        return false;
      }
      async function plot() {
        // get the values out of the form
        var data = {
          "chart": document.getElementById("chart").selectedOptions[0].value,
          "county": document.getElementById("county").selectedOptions[0].value,
          "interval": document.getElementById("interval").selectedOptions[0].value,
        };
        // submit a POST request with a JSON body
        var response = await fetch("/plot.json", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify(data),
        });
        // the response is the vega spec JSON
        var spec = await response.json();

        // the rest is
        var embedOpt = { mode: "vega-lite"};

        function showError(el, error) {
          el.innerHTML =
            '<div class="error" style="color:red;">' +
            "<p>JavaScript Error: " +
            error.message +
            "</p>" +
            "<p>This usually means there's a typo in your chart specification. " +
            "See the javascript console for the full traceback.</p>" +
            "</div>";
          throw error;
        }
        const el = document.getElementById("vis");
        vegaEmbed("#vis", spec, embedOpt).catch((error) =>
          showError(el, error)
        );
      }

      // invoke plot on page load
      plot();
    </script>
  </body>
</html>
